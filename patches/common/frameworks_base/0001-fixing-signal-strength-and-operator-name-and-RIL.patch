From 8f11576e5ff8dfb811b2365538740b026264101c Mon Sep 17 00:00:00 2001
From: k2wl <k2wl@github.com>
Date: Wed, 6 Aug 2014 22:26:32 +0530
Subject: [PATCH] fixing signal strength and operator name and RIL

Change-Id: I4c407194d29af7d200fa32b6647e01b5b79fc808
Signed-off-by: k2wl <k2wl@github.com>
---
 .../android/systemui/statusbar/phone/PhoneStatusBar.java |  5 +----
 telephony/java/android/telephony/SignalStrength.java     |  2 +-
 .../com/android/internal/telephony/RILConstants.java     | 16 ++++++++--------
 3 files changed, 10 insertions(+), 13 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBar.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBar.java
index 08ca930..a60fc7c 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBar.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBar.java
@@ -816,7 +816,6 @@ public class PhoneStatusBar extends BaseStatusBar implements DemoMode,
             }
 
             mCarrierLabel = (TextView)mStatusBarWindow.findViewById(R.id.carrier_label);
-            mSubsLabel = (TextView)mStatusBarWindow.findViewById(R.id.subs_label);
             mShowCarrierInPanel = (mCarrierLabel != null);
 
             if (DEBUG) Log.v(TAG, "carrierlabel=" + mCarrierLabel + " show=" +
@@ -827,12 +826,10 @@ public class PhoneStatusBar extends BaseStatusBar implements DemoMode,
                 // for mobile devices, we always show mobile connection info here (SPN/PLMN)
                 // for other devices, we show whatever network is connected
                 if (mMSimNetworkController.hasMobileDataFeature()) {
-                    mMSimNetworkController.addMobileLabelView(mCarrierLabel);
+                    mMSimNetworkController.addSubsLabelView(mCarrierLabel);
                 } else {
                     mMSimNetworkController.addCombinedLabelView(mCarrierLabel);
                 }
-                mSubsLabel.setVisibility(View.VISIBLE);
-                mMSimNetworkController.addSubsLabelView(mSubsLabel);
                 // set up the dynamic hide/show of the label
                 mPile.setOnSizeChangedListener(new OnSizeChangedListener() {
                     @Override
diff --git a/telephony/java/android/telephony/SignalStrength.java b/telephony/java/android/telephony/SignalStrength.java
index 896c472..1909a9f 100644
--- a/telephony/java/android/telephony/SignalStrength.java
+++ b/telephony/java/android/telephony/SignalStrength.java
@@ -423,7 +423,7 @@ public class SignalStrength implements Parcelable {
      * 27.007 8.5
      */
     public int getGsmSignalStrength() {
-        return this.mGsmSignalStrength;
+        return (0xFFFFFF00 & this.mGsmSignalStrength) / 85;
     }
 
     /**
diff --git a/telephony/java/com/android/internal/telephony/RILConstants.java b/telephony/java/com/android/internal/telephony/RILConstants.java
index e132d53..c8eb209 100644
--- a/telephony/java/com/android/internal/telephony/RILConstants.java
+++ b/telephony/java/com/android/internal/telephony/RILConstants.java
@@ -284,14 +284,14 @@ cat include/telephony/ril.h | \
     int RIL_REQUEST_ACKNOWLEDGE_INCOMING_GSM_SMS_WITH_PDU = 106;
     int RIL_REQUEST_STK_SEND_ENVELOPE_WITH_STATUS = 107;
     int RIL_REQUEST_VOICE_RADIO_TECH = 108;
-    int RIL_REQUEST_GET_CELL_INFO_LIST = 109;
-    int RIL_REQUEST_SET_UNSOL_CELL_INFO_LIST_RATE = 110;
-    int RIL_REQUEST_SET_INITIAL_ATTACH_APN = 111;
-    int RIL_REQUEST_IMS_REGISTRATION_STATE = 112;
-    int RIL_REQUEST_IMS_SEND_SMS = 113;
-    int RIL_REQUEST_GET_DATA_CALL_PROFILE = 114;
-    int RIL_REQUEST_SET_UICC_SUBSCRIPTION = 115;
-    int RIL_REQUEST_SET_DATA_SUBSCRIPTION = 116;
+    int RIL_REQUEST_GET_CELL_INFO_LIST = 116;
+    int RIL_REQUEST_SET_UNSOL_CELL_INFO_LIST_RATE = 114;
+    int RIL_REQUEST_SET_INITIAL_ATTACH_APN = 115;
+    int RIL_REQUEST_IMS_REGISTRATION_STATE = 109;
+    int RIL_REQUEST_IMS_SEND_SMS = 110;
+    int RIL_REQUEST_GET_DATA_CALL_PROFILE = 111;
+    int RIL_REQUEST_SET_UICC_SUBSCRIPTION = 112;
+    int RIL_REQUEST_SET_DATA_SUBSCRIPTION = 113;
 
     int RIL_UNSOL_RESPONSE_BASE = 1000;
     int RIL_UNSOL_RESPONSE_RADIO_STATE_CHANGED = 1000;
-- 
1.9.1

