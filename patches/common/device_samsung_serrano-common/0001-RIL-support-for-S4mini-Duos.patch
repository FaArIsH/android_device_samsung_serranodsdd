From 29dc80c819351e3d92d48bf74e2805df020b32b3 Mon Sep 17 00:00:00 2001
From: k2wl <k2wl@github.com>
Date: Tue, 12 Aug 2014 05:10:17 +0530
Subject: [PATCH] RIL support for S4mini Duos

Change-Id: I9fe89abfaceab561a568ae1d3097b4597cd4ac94
Signed-off-by: k2wl <k2wl@github.com>
---
 rootdir/init.qcom.ril.sh | 38 ++++++++++++++++++++++++++++++++++++++
 rootdir/init.target.rc   |  5 +++++
 serrano-common.mk        |  1 +
 3 files changed, 44 insertions(+)
 create mode 100755 rootdir/init.qcom.ril.sh

diff --git a/rootdir/init.qcom.ril.sh b/rootdir/init.qcom.ril.sh
new file mode 100755
index 0000000..c98c617
--- /dev/null
+++ b/rootdir/init.qcom.ril.sh
@@ -0,0 +1,38 @@
+#!/system/bin/sh
+# Copyright (c) 2012, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above copyright
+#       notice, this list of conditions and the following disclaimer in the
+#       documentation and/or other materials provided with the distribution.
+#     * Neither the name of The Linux Foundation nor
+#       the names of its contributors may be used to endorse or promote
+#       products derived from this software without specific prior written
+#       permission.
+#
+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+# IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+# NON-INFRINGEMENT ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
+# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
+# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
+# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
+# OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
+# OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
+# ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+
+#
+# start two rild when dsds property enabled
+#
+dsds=`getprop persist.multisim.config`
+if [ "$dsds" = "dsds" ]; then
+    setprop ro.multi.rild true
+    stop ril-daemon
+    start ril-daemon
+    start ril-daemon1
+fi
diff --git a/rootdir/init.target.rc b/rootdir/init.target.rc
index 73f703d..f5cfd0b 100644
--- a/rootdir/init.target.rc
+++ b/rootdir/init.target.rc
@@ -35,6 +35,11 @@ on early-init
     mkdir /efs 0771 system radio
     chmod 644 /proc/cmdline
 
+service ril-qmi /system/bin/sh /init.qcom.ril.sh
+    class main
+    user root
+    oneshot
+
 on fs
     mount_all fstab.qcom
 
diff --git a/serrano-common.mk b/serrano-common.mk
index 82ac457..31ff87e 100644
--- a/serrano-common.mk
+++ b/serrano-common.mk
@@ -64,6 +64,7 @@ PRODUCT_COPY_FILES += \
     $(LOCAL_PATH)/rootdir/init.qcom.syspart_fixup.sh:root/init.qcom.syspart_fixup.sh \
     $(LOCAL_PATH)/rootdir/init.qcom.usb.rc:root/init.qcom.usb.rc \
     $(LOCAL_PATH)/rootdir/init.target.rc:root/init.target.rc \
+    $(LOCAL_PATH)/rootdir/init.qcom.ril.sh:root/init.qcom.ril.sh \
     $(LOCAL_PATH)/rootdir/ueventd.qcom.rc:root/ueventd.qcom.rc
 
 # Etc scripts
-- 
1.9.1

